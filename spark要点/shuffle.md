Map端运行的task叫shuffleMapTask
每个shuffleMapTask都会为ResultTask创建一份bucket缓存，以及对应的shuffleBlockFile磁盘文件
shuffleMapTask的输出，回座位MapStatus发送到DAGScheduler的MAPOutputTrakerMaster中，然后resulttask去读取，mapstatus包含了，每个ResultTask要拉取数据的大小
每个resulttask会用blockstoreshufflefetcher去mapoutputtrackermaster获取自己要拉取的文件的信息，通过blockmanager拉去过来
每个resulttask拉去过来的数据，就会组成一个内部的RDD，叫shuffledRDD，优先放入内存，如果内存不够，写入磁盘
然后每个resulttask针对数据进行聚合，最后生成shuffleresultRDD，就是我们只想reduceByKey希望获得的那个RDD
mappartitionsRDD->shuffledRDD->shuffleresultRDD

特点1：
bucket缓存100kb，达到阈值刷写到磁盘，不容易发生OOM，如果内存缓存过小，会发生过多磁盘写IO操作
特点2：与MapReduce完全不一样的是，MapReduce必须将所有数据全部写入本地磁盘后，才能启动reduce拉取
spark默认情况下，不对数据进行排序，因此shuffleMapTask每写入一点数据，ResultTask就可以拉取一点数据

好处在于：比MapReduce快，但是MapReduce的ruduce可以处理每个key对应的value，但是spark是同步拉去，因此提供不了直接处理key对应的value算子，只能通过groupbykey，先shuffle，有一个mappartitionsRDD，然后用map来处理每个key对应的values。


优化后的shuffle
引入了consolidation机制，也就是说，提出了shuffleGroup的概念。